{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\niziToast.settings({\n  position: 'topRight',\n  iconColor: '#fff',\n  messageColor: '#fff',\n});\n\nexport async function searchImage(request, page = 1, per_page = 20) {\n  const API_KEY = '49598777-3dc21f1e795110eeeec900fde';\n  const URL =\n    'https://pixabay.com/api/?key=' +\n    API_KEY +\n    '&q=' +\n    encodeURIComponent(request) +\n    '&image_type=photo' +\n    '&orientation=horizontal' +\n    '&safesearch=true' +\n    '&page=' +\n    page +\n    '&per_page=' +\n    per_page;\n  try {\n    if (request == '') {\n      throw new Error('Please enter something!');\n    }\n    const result = await axios.get(URL);\n    if (result.data.hits == 0) {\n      throw new Error(\n        'Sorry, there are no images matching your search query. Please, try again!'\n      );\n    }\n\n    return { urls: [...result.data.hits], total: result.data.totalHits };\n  } catch (err) {\n    iziToast.error({\n      iconUrl: 'img/error.svg',\n      message: err.message,\n    });\n    return [];\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nlet gallery = new SimpleLightbox('.gallery a');\n\nexport function renderGallary(images, galleryHTML) {\n  let markup = images\n    .map(\n      image => `\n      <li>\n        <a href=\"${image.largeImageURL}\"><img src=\"${image.webformatURL}\" alt=\"${image.tags}\" width=\"360\" height=\"200\" /></a>\n        <table class=\"caption\">\n          <thead>\n            <tr>\n              <th>Likes</th>\n              <th>Views</th>\n              <th>Comments</th>\n              <th>Downloads</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td>${image.likes}</td>\n              <td>${image.views}</td>\n              <td>${image.comments}</td>\n              <td>${image.downloads}</td>\n            </tr>\n          </tbody>\n        </table>\n      </li>`\n    )\n    .join('');\n\n  galleryHTML.insertAdjacentHTML('beforeend', markup);\n  // const imgLd = galleryHTML.querySelectorAll('img');\n  // console.log(' renderGallary imgLd:', imgLd);\n\n  // const imgLdP = [...imgLd].map(img => {\n  //   return new Promise((resolve, reject) => {\n  //     img.onload = () => resolve(img);\n  //     if (0) {\n  //       reject();\n  //     }\n  //   });\n  // });\n  // console.log(' renderGallary imgLdP:', imgLdP);\n\n  // Promise.all(imgLdP).then();\n\n  gallery.refresh();\n\n  //   gallery.on('show.simplelightbox', function () {\n  //     // Do something…\n  //   });\n\n  // gallery.on('error.simplelightbox', function (e) {\n  //   console.log(e); // Some usefull information\n  // });\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { searchImage } from './js/pixabay-api';\nimport { renderGallary } from './js/render-functions';\n\nconst refs = {\n  form: document.querySelector('.form'),\n  gallery: document.querySelector('.gallery'),\n  loader: document.querySelector('.loading'),\n  moreImgBtn: document.getElementById('moreImgBtn'),\n  request: document.querySelector('.form input'),\n  submitBtn: document.querySelector('.form button'),\n};\n\nrefs.form.addEventListener('submit', handleSubmitClick);\nlet page = 1,\n  per_page = 20,\n  request = '';\n\nasync function handleSubmitClick(event) {\n  event.preventDefault();\n  refs.request.setAttribute('readonly', true); // Установить readonly для input\n  refs.submitBtn.disabled = true; // Отключить кнопку \"Submit\"\n  refs.loader.classList.remove('hidden'); // Показать загрузчик\n\n  request = refs.request.value.trim();\n\n  try {\n    const images = await searchImage(request, page, per_page);\n\n    refs.request.removeAttribute('readonly'); // Восстановить элементы\n    refs.submitBtn.disabled = false; // Включить кнопку \"Submit\"\n    refs.loader.classList.add('hidden'); // Скрыть загрузчик\n\n    // Проверка на пустой массив\n    if (!images || !images.urls || images.urls.length === 0) {\n      refs.gallery.innerHTML = ''; // Очищаем галерею\n      refs.moreImgBtn.classList.add('hidden'); // Скрываем кнопку \"More\"\n      iziToast.info({\n        position: 'topRight',\n        message: 'No images found. Please try a different search.',\n      });\n      return;\n    }\n\n    refs.gallery.innerHTML = '';\n    refs.request.value = '';\n    renderGallary(images.urls, refs.gallery);\n    needMoreBtnCheck(images); // Показать/скрыть кнопку \"More\"\n  } catch (error) {\n    console.error('Error fetching images:', error);\n    refs.request.removeAttribute('readonly'); // Восстановить элементы\n    refs.submitBtn.disabled = false; // Включить кнопку \"Submit\"\n    refs.loader.classList.add('hidden'); // Скрыть загрузчик\n    iziToast.error({\n      position: 'topRight',\n      message: 'An error occurred while fetching images. Please try again.',\n    });\n  }\n}\n\nasync function handleMoreClick(event) {\n  refs.loader.classList.remove('hidden'); // Показать текст загрузки\n  try {\n    const images = await searchImage(request, ++page, per_page);\n\n    // Проверка на пустой массив\n    if (!images || !images.urls || images.urls.length === 0) {\n      refs.loader.classList.add('hidden'); // Скрыть текст загрузки\n      refs.moreImgBtn.classList.add('hidden'); // Скрыть кнопку \"More\"\n      iziToast.info({\n        position: 'topRight',\n        message: 'No more images found.',\n      });\n      return;\n    }\n\n    const lastGalleryCard = refs.gallery.lastElementChild; // Запомнить последний элемент перед добавлением новых\n    renderGallary(images.urls, refs.gallery);\n    refs.loader.classList.add('hidden'); // Скрыть текст загрузки\n    needMoreBtnCheck(images); // Показать/скрыть кнопку \"More\"\n\n    const { top: lastCardPos } = lastGalleryCard.getBoundingClientRect();\n    window.scrollBy({ top: lastCardPos - 24, behavior: 'smooth' }); // Прокрутить к верхней границе последней карточки\n  } catch (error) {\n    console.error('Error fetching more images:', error);\n    refs.loader.classList.add('hidden'); // Скрыть текст загрузки\n    iziToast.error({\n      position: 'topRight',\n      message:\n        'An error occurred while fetching more images. Please try again.',\n    });\n  }\n}\n\nfunction needMoreBtnCheck(images) {\n  if (\n    !images ||\n    !images.urls ||\n    images.urls.length < per_page ||\n    images.total === page * per_page\n  ) {\n    refs.moreImgBtn.classList.add('hidden'); // Скрыть кнопку \"More\"\n    refs.moreImgBtn.removeEventListener('click', handleMoreClick);\n    iziToast.info({\n      position: 'topRight',\n      message: \"We're sorry, but you've reached the end of search results.\",\n    });\n  } else {\n    refs.moreImgBtn.classList.remove('hidden'); // Показать кнопку \"More\"\n    refs.moreImgBtn.addEventListener('click', handleMoreClick);\n  }\n}\n"],"names":["iziToast","searchImage","request","page","per_page","URL","result","axios","err","gallery","SimpleLightbox","renderGallary","images","galleryHTML","markup","image","refs","handleSubmitClick","event","needMoreBtnCheck","error","handleMoreClick","lastGalleryCard","lastCardPos"],"mappings":"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"}